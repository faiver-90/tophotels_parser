@echo off
setlocal ENABLEDELAYEDEXPANSION

REM ===============================================
REM Запуск PowerShell-скрипта "setup_git_and_update.ps1"
REM Скрипт:
REM  1) Проверяет/ставит Git
REM  2) Настраивает user.name/user.email
REM  3) В текущем git-репозитории подтягивает обновления
REM Параметр: путь к репозиторию (по умолчанию текущая папка).
REM ===============================================

set SCRIPT_DIR=%~dp0
set PS1=%SCRIPT_DIR%setup_git_and_update.ps1

if not exist "%PS1%" (
    echo [ERR ] Не найден файл %PS1%
    exit /b 1
)

REM Передадим первым аргументом путь к репозиторию (или "." если не задан)
set REPO=%1
if "%REPO%"=="" set REPO=.

powershell -NoProfile -ExecutionPolicy Bypass -File "%PS1%" -RepoPath "%REPO%"
set EXITCODE=%ERRORLEVEL%

if %EXITCODE% NEQ 0 (
    echo [ERR ] Скрипт завершился с кодом %EXITCODE%
    exit /b %EXITCODE%
)

echo [ OK ] Готово.
exit /b 0
